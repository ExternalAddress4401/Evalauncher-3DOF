"use strict";(()=>{var u=function(e,t,o,n){var r=arguments.length,s=r<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,o):n,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s},G;(function(e){b(e,"apiLevel",()=>{let o=t("ro.build.version.sdk");return o?parseInt(o):null},c);function t(o){let n=Module.findExportByName("libc.so","__system_property_get");if(n){let r=new NativeFunction(n,"void",["pointer","pointer"]),s=Memory.alloc(92).writePointer(NULL);return r(Memory.allocUtf8String(o),s),s.readCString()??void 0}}})(G||(G={}));function m(e){let t=new Error(`\x1B[0m${e}`);throw t.name="\x1B[0m\x1B[38;5;9mil2cpp\x1B[0m",t.stack=t.stack?.replace(/^Error/,t.name)?.replace(/\n    at (.+) \((.+):(.+)\)/,"\x1B[3m\x1B[2m")?.concat("\x1B[0m"),t}function A(e){globalThis.console.log(`\x1B[38;5;11mil2cpp\x1B[0m: ${e}`)}function O(e){globalThis.console.log(`\x1B[38;5;10mil2cpp\x1B[0m: ${e}`)}function P(e){globalThis.console.log(`\x1B[38;5;12mil2cpp\x1B[0m: ${e}`)}function V(e,t,o=Object.getOwnPropertyDescriptors(e)){for(let n in o)o[n]=t(e,n,o[n]);return Object.defineProperties(e,o),e}function b(e,t,o,n){globalThis.Object.defineProperty(e,t,n?.(e,t,{get:o,configurable:!0})??{get:o,configurable:!0})}function c(e,t,o){let n=o.get;if(!n)throw new Error("@lazy can only be applied to getter accessors");return o.get=function(){let r=n.call(this);return Object.defineProperty(this,t,{value:r,configurable:o.configurable,enumerable:o.enumerable,writable:!1}),r},o}var _=class{handle;constructor(t){t instanceof NativePointer?this.handle=t:this.handle=t.handle}equals(t){return this.handle.equals(t.handle)}isNull(){return this.handle.isNull()}asNullable(){return this.isNull()?null:this}};function z(...e){function t(o,n,r=s=>s.readUtf8String()){let s=Module.findExportByName(o,n)??NULL;if(!s.isNull())return{handle:s,readString:r}}return new Promise(o=>{for(let i of e){let a=Process.findModuleByName(i);if(a!=null){o(a);return}}let n=[];switch(Process.platform){case"linux":if(G.apiLevel==null){n=[t(null,"dlopen")];break}n=(Process.findModuleByName("linker64")??Process.getModuleByName("linker")).enumerateSymbols().filter(i=>["__dl___loader_dlopen","__dl__Z8__dlopenPKciPKv","__dl_open"].includes(i.name)).map(i=>({handle:i.address,readString:a=>a.readCString()}));break;case"darwin":n=[t("libdyld.dylib","dlopen")];break;case"windows":n=[t("kernel32.dll","LoadLibraryW",i=>i.readUtf16String()),t("kernel32.dll","LoadLibraryExW",i=>i.readUtf16String()),t("kernel32.dll","LoadLibraryA",i=>i.readAnsiString()),t("kernel32.dll","LoadLibraryExA",i=>i.readAnsiString())];break}n=n.filter(i=>i),n.length==0&&m(`there are no targets to hook the loading of \x1B[3m${e}\x1B[0m, please file a bug`);let r=setTimeout(()=>{for(let i of e){let a=Process.findModuleByName(i);if(a!=null){A(`\x1B[3m${a.name}\x1B[0m has been loaded, but such event hasn't been detected - please file a bug`),clearTimeout(r),s.forEach(l=>l.detach()),o(a);return}}A(`10 seconds have passed and \x1B[3m${e}\x1B[0m has not been loaded yet, is the app running?`)},1e4),s=n.map(i=>Interceptor.attach(i.handle,{onEnter(a){this.modulePath=i.readString(a[0])??""},onLeave(a){for(let l of e)if(this.modulePath.endsWith(l)){let h=Process.findModuleByName(this.modulePath);if(h!=null){setImmediate(()=>{clearTimeout(r),s.forEach(y=>y.detach())}),o(h);break}}}}))})}NativePointer.prototype.offsetOf=function(e,t){t??=512;for(let o=0;t>0?o<t:o<-t;o++)if(e(t>0?this.add(o):this.sub(o)))return o;return null};function w(e){let t=[],o=Memory.alloc(Process.pointerSize),n=e(o);for(;!n.isNull();)t.push(n),n=e(o);return t}function M(e){let t=Memory.alloc(Process.pointerSize),o=e(t);if(o.isNull())return[];let n=new Array(t.readInt());for(let r=0;r<n.length;r++)n[r]=o.add(r*Process.pointerSize).readPointer();return n}function x(e){return new Proxy(e,{cache:new Map,construct(t,o){let n=o[0].toUInt32();return this.cache.has(n)||this.cache.set(n,new t(o[0])),this.cache.get(n)}})}var v;(function(e){let t=/(20\d{2}|\d)\.(\d)\.(\d{1,2})(?:[abcfp]|rc){0,2}\d?/;function o(i){return i?.match(t)?.[0]}e.find=o;function n(i,a){return s(i,a)>=0}e.gte=n;function r(i,a){return s(i,a)<0}e.lt=r;function s(i,a){let l=i.match(t),h=a.match(t);for(let y=1;y<=3;y++){let f=Number(l?.[y]??-1),S=Number(h?.[y]??-1);if(f>S)return 1;if(f<S)return-1}return 0}})(v||(v={}));var d;(function(e){e.api={get alloc(){return t("il2cpp_alloc","pointer",["size_t"])},get arrayGetLength(){return t("il2cpp_array_length","uint32",["pointer"])},get arrayNew(){return t("il2cpp_array_new","pointer",["pointer","uint32"])},get assemblyGetImage(){return t("il2cpp_assembly_get_image","pointer",["pointer"])},get classForEach(){return t("il2cpp_class_for_each","void",["pointer","pointer"])},get classFromName(){return t("il2cpp_class_from_name","pointer",["pointer","pointer","pointer"])},get classFromObject(){return t("il2cpp_class_from_system_type","pointer",["pointer"])},get classGetArrayClass(){return t("il2cpp_array_class_get","pointer",["pointer","uint32"])},get classGetArrayElementSize(){return t("il2cpp_class_array_element_size","int",["pointer"])},get classGetAssemblyName(){return t("il2cpp_class_get_assemblyname","pointer",["pointer"])},get classGetBaseType(){return t("il2cpp_class_enum_basetype","pointer",["pointer"])},get classGetDeclaringType(){return t("il2cpp_class_get_declaring_type","pointer",["pointer"])},get classGetElementClass(){return t("il2cpp_class_get_element_class","pointer",["pointer"])},get classGetFieldFromName(){return t("il2cpp_class_get_field_from_name","pointer",["pointer","pointer"])},get classGetFields(){return t("il2cpp_class_get_fields","pointer",["pointer","pointer"])},get classGetFlags(){return t("il2cpp_class_get_flags","int",["pointer"])},get classGetImage(){return t("il2cpp_class_get_image","pointer",["pointer"])},get classGetInstanceSize(){return t("il2cpp_class_instance_size","int32",["pointer"])},get classGetInterfaces(){return t("il2cpp_class_get_interfaces","pointer",["pointer","pointer"])},get classGetMethodFromName(){return t("il2cpp_class_get_method_from_name","pointer",["pointer","pointer","int"])},get classGetMethods(){return t("il2cpp_class_get_methods","pointer",["pointer","pointer"])},get classGetName(){return t("il2cpp_class_get_name","pointer",["pointer"])},get classGetNamespace(){return t("il2cpp_class_get_namespace","pointer",["pointer"])},get classGetNestedClasses(){return t("il2cpp_class_get_nested_types","pointer",["pointer","pointer"])},get classGetParent(){return t("il2cpp_class_get_parent","pointer",["pointer"])},get classGetStaticFieldData(){return t("il2cpp_class_get_static_field_data","pointer",["pointer"])},get classGetValueTypeSize(){return t("il2cpp_class_value_size","int32",["pointer","pointer"])},get classGetType(){return t("il2cpp_class_get_type","pointer",["pointer"])},get classHasReferences(){return t("il2cpp_class_has_references","bool",["pointer"])},get classInitialize(){return t("il2cpp_runtime_class_init","void",["pointer"])},get classIsAbstract(){return t("il2cpp_class_is_abstract","bool",["pointer"])},get classIsAssignableFrom(){return t("il2cpp_class_is_assignable_from","bool",["pointer","pointer"])},get classIsBlittable(){return t("il2cpp_class_is_blittable","bool",["pointer"])},get classIsEnum(){return t("il2cpp_class_is_enum","bool",["pointer"])},get classIsGeneric(){return t("il2cpp_class_is_generic","bool",["pointer"])},get classIsInflated(){return t("il2cpp_class_is_inflated","bool",["pointer"])},get classIsInterface(){return t("il2cpp_class_is_interface","bool",["pointer"])},get classIsSubclassOf(){return t("il2cpp_class_is_subclass_of","bool",["pointer","pointer","bool"])},get classIsValueType(){return t("il2cpp_class_is_valuetype","bool",["pointer"])},get domainGetAssemblyFromName(){return t("il2cpp_domain_assembly_open","pointer",["pointer","pointer"])},get domainGet(){return t("il2cpp_domain_get","pointer",[])},get domainGetAssemblies(){return t("il2cpp_domain_get_assemblies","pointer",["pointer","pointer"])},get fieldGetClass(){return t("il2cpp_field_get_parent","pointer",["pointer"])},get fieldGetFlags(){return t("il2cpp_field_get_flags","int",["pointer"])},get fieldGetName(){return t("il2cpp_field_get_name","pointer",["pointer"])},get fieldGetOffset(){return t("il2cpp_field_get_offset","int32",["pointer"])},get fieldGetStaticValue(){return t("il2cpp_field_static_get_value","void",["pointer","pointer"])},get fieldGetType(){return t("il2cpp_field_get_type","pointer",["pointer"])},get fieldSetStaticValue(){return t("il2cpp_field_static_set_value","void",["pointer","pointer"])},get free(){return t("il2cpp_free","void",["pointer"])},get gcCollect(){return t("il2cpp_gc_collect","void",["int"])},get gcCollectALittle(){return t("il2cpp_gc_collect_a_little","void",[])},get gcDisable(){return t("il2cpp_gc_disable","void",[])},get gcEnable(){return t("il2cpp_gc_enable","void",[])},get gcGetHeapSize(){return t("il2cpp_gc_get_heap_size","int64",[])},get gcGetMaxTimeSlice(){return t("il2cpp_gc_get_max_time_slice_ns","int64",[])},get gcGetUsedSize(){return t("il2cpp_gc_get_used_size","int64",[])},get gcHandleGetTarget(){return t("il2cpp_gchandle_get_target","pointer",["uint32"])},get gcHandleFree(){return t("il2cpp_gchandle_free","void",["uint32"])},get gcHandleNew(){return t("il2cpp_gchandle_new","uint32",["pointer","bool"])},get gcHandleNewWeakRef(){return t("il2cpp_gchandle_new_weakref","uint32",["pointer","bool"])},get gcIsDisabled(){return t("il2cpp_gc_is_disabled","bool",[])},get gcIsIncremental(){return t("il2cpp_gc_is_incremental","bool",[])},get gcSetMaxTimeSlice(){return t("il2cpp_gc_set_max_time_slice_ns","void",["int64"])},get gcStartIncrementalCollection(){return t("il2cpp_gc_start_incremental_collection","void",[])},get gcStartWorld(){return t("il2cpp_start_gc_world","void",[])},get gcStopWorld(){return t("il2cpp_stop_gc_world","void",[])},get getCorlib(){return t("il2cpp_get_corlib","pointer",[])},get imageGetAssembly(){return t("il2cpp_image_get_assembly","pointer",["pointer"])},get imageGetClass(){return t("il2cpp_image_get_class","pointer",["pointer","uint"])},get imageGetClassCount(){return t("il2cpp_image_get_class_count","uint32",["pointer"])},get imageGetName(){return t("il2cpp_image_get_name","pointer",["pointer"])},get initialize(){return t("il2cpp_init","void",["pointer"])},get livenessAllocateStruct(){return t("il2cpp_unity_liveness_allocate_struct","pointer",["pointer","int","pointer","pointer","pointer"])},get livenessCalculationBegin(){return t("il2cpp_unity_liveness_calculation_begin","pointer",["pointer","int","pointer","pointer","pointer","pointer"])},get livenessCalculationEnd(){return t("il2cpp_unity_liveness_calculation_end","void",["pointer"])},get livenessCalculationFromStatics(){return t("il2cpp_unity_liveness_calculation_from_statics","void",["pointer"])},get livenessFinalize(){return t("il2cpp_unity_liveness_finalize","void",["pointer"])},get livenessFreeStruct(){return t("il2cpp_unity_liveness_free_struct","void",["pointer"])},get memorySnapshotCapture(){return t("il2cpp_capture_memory_snapshot","pointer",[])},get memorySnapshotFree(){return t("il2cpp_free_captured_memory_snapshot","void",["pointer"])},get memorySnapshotGetClasses(){return t("il2cpp_memory_snapshot_get_classes","pointer",["pointer","pointer"])},get memorySnapshotGetObjects(){return t("il2cpp_memory_snapshot_get_objects","pointer",["pointer","pointer"])},get methodGetClass(){return t("il2cpp_method_get_class","pointer",["pointer"])},get methodGetFlags(){return t("il2cpp_method_get_flags","uint32",["pointer","pointer"])},get methodGetName(){return t("il2cpp_method_get_name","pointer",["pointer"])},get methodGetObject(){return t("il2cpp_method_get_object","pointer",["pointer","pointer"])},get methodGetParameterCount(){return t("il2cpp_method_get_param_count","uint8",["pointer"])},get methodGetParameterName(){return t("il2cpp_method_get_param_name","pointer",["pointer","uint32"])},get methodGetParameters(){return t("il2cpp_method_get_parameters","pointer",["pointer","pointer"])},get methodGetParameterType(){return t("il2cpp_method_get_param","pointer",["pointer","uint32"])},get methodGetReturnType(){return t("il2cpp_method_get_return_type","pointer",["pointer"])},get methodIsGeneric(){return t("il2cpp_method_is_generic","bool",["pointer"])},get methodIsInflated(){return t("il2cpp_method_is_inflated","bool",["pointer"])},get methodIsInstance(){return t("il2cpp_method_is_instance","bool",["pointer"])},get monitorEnter(){return t("il2cpp_monitor_enter","void",["pointer"])},get monitorExit(){return t("il2cpp_monitor_exit","void",["pointer"])},get monitorPulse(){return t("il2cpp_monitor_pulse","void",["pointer"])},get monitorPulseAll(){return t("il2cpp_monitor_pulse_all","void",["pointer"])},get monitorTryEnter(){return t("il2cpp_monitor_try_enter","bool",["pointer","uint32"])},get monitorTryWait(){return t("il2cpp_monitor_try_wait","bool",["pointer","uint32"])},get monitorWait(){return t("il2cpp_monitor_wait","void",["pointer"])},get objectGetClass(){return t("il2cpp_object_get_class","pointer",["pointer"])},get objectGetVirtualMethod(){return t("il2cpp_object_get_virtual_method","pointer",["pointer","pointer"])},get objectInitialize(){return t("il2cpp_runtime_object_init_exception","void",["pointer","pointer"])},get objectNew(){return t("il2cpp_object_new","pointer",["pointer"])},get objectGetSize(){return t("il2cpp_object_get_size","uint32",["pointer"])},get objectUnbox(){return t("il2cpp_object_unbox","pointer",["pointer"])},get resolveInternalCall(){return t("il2cpp_resolve_icall","pointer",["pointer"])},get stringGetChars(){return t("il2cpp_string_chars","pointer",["pointer"])},get stringGetLength(){return t("il2cpp_string_length","int32",["pointer"])},get stringNew(){return t("il2cpp_string_new","pointer",["pointer"])},get valueTypeBox(){return t("il2cpp_value_box","pointer",["pointer","pointer"])},get threadAttach(){return t("il2cpp_thread_attach","pointer",["pointer"])},get threadDetach(){return t("il2cpp_thread_detach","void",["pointer"])},get threadGetAttachedThreads(){return t("il2cpp_thread_get_all_attached_threads","pointer",["pointer"])},get threadGetCurrent(){return t("il2cpp_thread_current","pointer",[])},get threadIsVm(){return t("il2cpp_is_vm_thread","bool",["pointer"])},get typeGetClass(){return t("il2cpp_class_from_type","pointer",["pointer"])},get typeGetName(){return t("il2cpp_type_get_name","pointer",["pointer"])},get typeGetObject(){return t("il2cpp_type_get_object","pointer",["pointer"])},get typeGetTypeEnum(){return t("il2cpp_type_get_type","int",["pointer"])}},V(e.api,c),b(e,"memorySnapshotApi",()=>new CModule(`#include <stdint.h>
#include <string.h>

typedef struct Il2CppManagedMemorySnapshot Il2CppManagedMemorySnapshot;
typedef struct Il2CppMetadataType Il2CppMetadataType;

struct Il2CppManagedMemorySnapshot
{
  struct Il2CppManagedHeap
  {
    uint32_t section_count;
    void * sections;
  } heap;
  struct Il2CppStacks
  {
    uint32_t stack_count;
    void * stacks;
  } stacks;
  struct Il2CppMetadataSnapshot
  {
    uint32_t type_count;
    Il2CppMetadataType * types;
  } metadata_snapshot;
  struct Il2CppGCHandles
  {
    uint32_t tracked_object_count;
    void ** pointers_to_objects;
  } gc_handles;
  struct Il2CppRuntimeInformation
  {
    uint32_t pointer_size;
    uint32_t object_header_size;
    uint32_t array_header_size;
    uint32_t array_bounds_offset_in_header;
    uint32_t array_size_offset_in_header;
    uint32_t allocation_granularity;
  } runtime_information;
  void * additional_user_information;
};

struct Il2CppMetadataType
{
  uint32_t flags;
  void * fields;
  uint32_t field_count;
  uint32_t statics_size;
  uint8_t * statics;
  uint32_t base_or_element_type_index;
  char * name;
  const char * assembly_name;
  uint64_t type_info_address;
  uint32_t size;
};

uintptr_t
il2cpp_memory_snapshot_get_classes (
    const Il2CppManagedMemorySnapshot * snapshot, Il2CppMetadataType ** iter)
{
  const int zero = 0;
  const void * null = 0;

  if (iter != NULL && snapshot->metadata_snapshot.type_count > zero)
  {
    if (*iter == null)
    {
      *iter = snapshot->metadata_snapshot.types;
      return (uintptr_t) (*iter)->type_info_address;
    }
    else
    {
      Il2CppMetadataType * metadata_type = *iter + 1;

      if (metadata_type < snapshot->metadata_snapshot.types +
                              snapshot->metadata_snapshot.type_count)
      {
        *iter = metadata_type;
        return (uintptr_t) (*iter)->type_info_address;
      }
    }
  }
  return 0;
}

void **
il2cpp_memory_snapshot_get_objects (
    const Il2CppManagedMemorySnapshot * snapshot, uint32_t * size)
{
  *size = snapshot->gc_handles.tracked_object_count;
  return snapshot->gc_handles.pointers_to_objects;
}
`),c);function t(o,n,r){let s=globalThis.IL2CPP_EXPORTS?.[o]?.()??e.module.findExportByName(o)??e.memorySnapshotApi[o];return new NativeFunction(s??m(`couldn't resolve export ${o}`),n,r)}})(d||(d={}));var d;(function(e){e.application={get dataPath(){return t("get_persistentDataPath")},get identifier(){return t("get_identifier")??t("get_bundleIdentifier")},get version(){return t("get_version")}},b(e,"unityVersion",()=>{try{let n=globalThis.IL2CPP_UNITY_VERSION??t("get_unityVersion");if(n!=null)return n}catch{}let o="69 6c 32 63 70 70";for(let n of e.module.enumerateRanges("r--").concat(Process.getRangeByAddress(e.module.base)))for(let{address:r}of Memory.scanSync(n.base,n.size,o)){for(;r.readU8()!=0;)r=r.sub(1);let s=v.find(r.add(1).readCString());if(s!=null)return s}m("couldn't determine the Unity version, please specify it manually")},c),b(e,"unityVersionIsBelow201830",()=>v.lt(e.unityVersion,"2018.3.0"),c),b(e,"unityVersionIsBelow202120",()=>v.lt(e.unityVersion,"2021.2.0"),c);function t(o){let n=e.api.resolveInternalCall(Memory.allocUtf8String("UnityEngine.Application::"+o)),r=new NativeFunction(n,"pointer",[]);return r.isNull()?null:new e.String(r()).asNullable()?.content??null}})(d||(d={}));var d;(function(e){function t(o,n){o=o??`${e.application.identifier??"unknown"}_${e.application.version??"unknown"}.cs`;let r=`${n??e.application.dataPath}/${o}`,s=new File(r,"w");for(let i of e.domain.assemblies){P(`dumping ${i.name}...`);for(let a of i.image.classes)s.write(`${a}

`)}s.flush(),s.close(),O(`dump saved to ${r}`)}e.dump=t})(d||(d={}));var d;(function(e){function t(o="current"){let n=e.api.threadGetCurrent();return Interceptor.attach(e.module.getExportByName("__cxa_throw"),function(r){o=="current"&&!e.api.threadGetCurrent().equals(n)||P(new e.Object(r[0].readPointer()))})}e.installExceptionListener=t})(d||(d={}));var d;(function(e){function t(n){return r=>r instanceof e.Class?n.isAssignableFrom(r):n.isAssignableFrom(r.class)}e.is=t;function o(n){return r=>r instanceof e.Class?r.equals(n):r.class.equals(n)}e.isExactly=o})(d||(d={}));var d;(function(e){e.gc={get heapSize(){return e.api.gcGetHeapSize()},get isEnabled(){return!e.api.gcIsDisabled()},get isIncremental(){return!!e.api.gcIsIncremental()},get maxTimeSlice(){return e.api.gcGetMaxTimeSlice()},get usedHeapSize(){return e.api.gcGetUsedSize()},set isEnabled(t){t?e.api.gcEnable():e.api.gcDisable()},set maxTimeSlice(t){e.api.gcSetMaxTimeSlice(t)},choose(t){let o=[],n=(s,i)=>{for(let a=0;a<i;a++)o.push(new e.Object(s.add(a*Process.pointerSize).readPointer()))},r=new NativeCallback(n,"void",["pointer","int","pointer"]);if(e.unityVersionIsBelow202120){let s=new NativeCallback(()=>{},"void",[]),i=e.api.livenessCalculationBegin(t,0,r,NULL,s,s);e.api.livenessCalculationFromStatics(i),e.api.livenessCalculationEnd(i)}else{let s=(l,h)=>!l.isNull()&&h.compare(0)==0?(e.free(l),NULL):e.alloc(h),i=new NativeCallback(s,"pointer",["pointer","size_t","pointer"]);this.stopWorld();let a=e.api.livenessAllocateStruct(t,0,r,NULL,i);e.api.livenessCalculationFromStatics(a),e.api.livenessFinalize(a),this.startWorld(),e.api.livenessFreeStruct(a)}return o},collect(t){e.api.gcCollect(t<0?0:t>2?2:t)},collectALittle(){e.api.gcCollectALittle()},startWorld(){return e.api.gcStartWorld()},startIncrementalCollection(){return e.api.gcStartIncrementalCollection()},stopWorld(){return e.api.gcStopWorld()}}})(d||(d={}));var d;(function(e){function t(a=Process.pointerSize){return e.api.alloc(a)}e.alloc=t;function o(a){return e.api.free(a)}e.free=o;function n(a,l){switch(l.typeEnum){case e.Type.enum.boolean:return!!a.readS8();case e.Type.enum.byte:return a.readS8();case e.Type.enum.unsignedByte:return a.readU8();case e.Type.enum.short:return a.readS16();case e.Type.enum.unsignedShort:return a.readU16();case e.Type.enum.int:return a.readS32();case e.Type.enum.unsignedInt:return a.readU32();case e.Type.enum.char:return a.readU16();case e.Type.enum.long:return a.readS64();case e.Type.enum.unsignedLong:return a.readU64();case e.Type.enum.float:return a.readFloat();case e.Type.enum.double:return a.readDouble();case e.Type.enum.nativePointer:case e.Type.enum.unsignedNativePointer:return a.readPointer();case e.Type.enum.pointer:return new e.Pointer(a.readPointer(),l.class.baseType);case e.Type.enum.valueType:return new e.ValueType(a,l);case e.Type.enum.object:case e.Type.enum.class:return new e.Object(a.readPointer());case e.Type.enum.genericInstance:return l.class.isValueType?new e.ValueType(a,l):new e.Object(a.readPointer());case e.Type.enum.string:return new e.String(a.readPointer());case e.Type.enum.array:case e.Type.enum.multidimensionalArray:return new e.Array(a.readPointer())}m(`couldn't read the value from ${a} using an unhandled or unknown type ${l.name} (${l.typeEnum}), please file an issue`)}e.read=n;function r(a,l,h){switch(h.typeEnum){case e.Type.enum.boolean:return a.writeS8(+l);case e.Type.enum.byte:return a.writeS8(l);case e.Type.enum.unsignedByte:return a.writeU8(l);case e.Type.enum.short:return a.writeS16(l);case e.Type.enum.unsignedShort:return a.writeU16(l);case e.Type.enum.int:return a.writeS32(l);case e.Type.enum.unsignedInt:return a.writeU32(l);case e.Type.enum.char:return a.writeU16(l);case e.Type.enum.long:return a.writeS64(l);case e.Type.enum.unsignedLong:return a.writeU64(l);case e.Type.enum.float:return a.writeFloat(l);case e.Type.enum.double:return a.writeDouble(l);case e.Type.enum.nativePointer:case e.Type.enum.unsignedNativePointer:case e.Type.enum.pointer:case e.Type.enum.string:case e.Type.enum.array:case e.Type.enum.multidimensionalArray:return a.writePointer(l);case e.Type.enum.valueType:return Memory.copy(a,l,h.class.valueTypeSize),a;case e.Type.enum.object:case e.Type.enum.class:case e.Type.enum.genericInstance:return l instanceof e.ValueType?(Memory.copy(a,l,h.class.valueTypeSize),a):a.writePointer(l)}m(`couldn't write value ${l} to ${a} using an unhandled or unknown type ${h.name} (${h.typeEnum}), please file an issue`)}e.write=r;function s(a,l){if(globalThis.Array.isArray(a)){let h=Memory.alloc(l.class.valueTypeSize),y=l.class.fields.filter(f=>!f.isStatic);for(let f=0;f<y.length;f++){let S=s(a[f],y[f].type);r(h.add(y[f].offset).sub(e.Object.headerSize),S,y[f].type)}return new e.ValueType(h,l)}else if(a instanceof NativePointer){if(l.isByReference)return new e.Reference(a,l);switch(l.typeEnum){case e.Type.enum.pointer:return new e.Pointer(a,l.class.baseType);case e.Type.enum.string:return new e.String(a);case e.Type.enum.class:case e.Type.enum.genericInstance:case e.Type.enum.object:return new e.Object(a);case e.Type.enum.array:case e.Type.enum.multidimensionalArray:return new e.Array(a);default:return a}}else return l.typeEnum==e.Type.enum.boolean?!!a:l.typeEnum==e.Type.enum.valueType&&l.class.isEnum?s([a],l):a}e.fromFridaValue=s;function i(a){if(typeof a=="boolean")return+a;if(a instanceof e.ValueType){if(a.type.class.isEnum)return a.field("value__").value;{let l=a.type.class.fields.filter(h=>!h.isStatic).map(h=>i(h.withHolder(a).value));return l.length==0?[0]:l}}else return a}e.toFridaValue=i})(d||(d={}));var d;(function(e){b(e,"module",()=>{let[n,r]=o();return Process.findModuleByName(n)??Process.getModuleByName(r)});async function t(n=!1){return Reflect.defineProperty(e,"module",{value:Process.platform=="darwin"?Process.findModuleByAddress(DebugSymbol.fromName("il2cpp_init").address)??await z(...o()):await z(...o())}),e.api.getCorlib().isNull()?await new Promise(r=>{let s=Interceptor.attach(e.api.initialize,{onLeave(){s.detach(),n?r(!0):setImmediate(()=>r(!1))}})}):!1}e.initialize=t;function o(){if(globalThis.IL2CPP_MODULE_NAME)return[globalThis.IL2CPP_MODULE_NAME];switch(Process.platform){case"linux":return[G.apiLevel?"libil2cpp.so":"GameAssembly.so"];case"windows":return["GameAssembly.dll"];case"darwin":return["UnityFramework","GameAssembly.dylib"]}m(`${Process.platform} is not supported yet`)}})(d||(d={}));var d;(function(e){async function t(o,n="bind"){try{let r=await e.initialize(n=="main");if(n=="main"&&!r)return t(()=>e.mainThread.schedule(o),"free");let s=e.currentThread,i=s==null;s??=e.domain.attach();let a=o();return i&&(n=="free"?s.detach():n=="bind"&&Script.bindWeak(globalThis,()=>s.detach())),a instanceof Promise?await a:a}catch(r){return Script.nextTick(s=>{throw s},r),Promise.reject(r)}}e.perform=t})(d||(d={}));var d;(function(e){class t{#e={depth:0,buffer:[],history:new Set,flush:()=>{if(this.#e.depth==0){let i=`
${this.#e.buffer.join(`
`)}
`;if(this.#d)P(i);else{let a=r(i);this.#e.history.has(a)||(this.#e.history.add(a),P(i))}this.#e.buffer.length=0}}};#u=e.mainThread.id;#d=!1;#h;#c=[];#l;#t;#n;#r;#s;#i;#a;#o;constructor(i){this.#h=i}thread(i){return this.#u=i.id,this}verbose(i){return this.#d=i,this}domain(){return this.#l=e.domain,this}assemblies(...i){return this.#t=i,this}classes(...i){return this.#n=i,this}methods(...i){return this.#r=i,this}filterAssemblies(i){return this.#s=i,this}filterClasses(i){return this.#i=i,this}filterMethods(i){return this.#a=i,this}filterParameters(i){return this.#o=i,this}and(){let i=g=>{if(this.#o==null){this.#c.push(g);return}for(let p of g.parameters)if(this.#o(p)){this.#c.push(g);break}},a=g=>{for(let p of g)i(p)},l=g=>{if(this.#a==null){a(g.methods);return}for(let p of g.methods)this.#a(p)&&i(p)},h=g=>{for(let p of g)l(p)},y=g=>{if(this.#i==null){h(g.image.classes);return}for(let p of g.image.classes)this.#i(p)&&l(p)},f=g=>{for(let p of g)y(p)},S=g=>{if(this.#s==null){f(g.assemblies);return}for(let p of g.assemblies)this.#s(p)&&y(p)};return this.#r?a(this.#r):this.#n?h(this.#n):this.#t?f(this.#t):this.#l&&S(this.#l),this.#t=void 0,this.#n=void 0,this.#r=void 0,this.#s=void 0,this.#i=void 0,this.#a=void 0,this.#o=void 0,this}attach(){for(let i of this.#c)if(!i.virtualAddress.isNull())try{this.#h(i,this.#e,this.#u)}catch(a){switch(a.message){case/unable to intercept function at \w+; please file a bug/.exec(a.message)?.input:case"already replaced this function":break;default:throw a}}}}e.Tracer=t;function o(s=!1){let i=()=>(l,h,y)=>{let f=l.relativeVirtualAddress.toString(16).padStart(8,"0");Interceptor.attach(l.virtualAddress,{onEnter(){this.threadId==y&&h.buffer.push(`\x1B[2m0x${f}\x1B[0m ${"\u2502 ".repeat(h.depth++)}\u250C\u2500\x1B[35m${l.class.type.name}::\x1B[1m${l.name}\x1B[0m\x1B[0m`)},onLeave(){this.threadId==y&&(h.buffer.push(`\x1B[2m0x${f}\x1B[0m ${"\u2502 ".repeat(--h.depth)}\u2514\u2500\x1B[33m${l.class.type.name}::\x1B[1m${l.name}\x1B[0m\x1B[0m`),h.flush())}})},a=()=>(l,h,y)=>{let f=l.relativeVirtualAddress.toString(16).padStart(8,"0"),S=+!l.isStatic|+e.unityVersionIsBelow201830,g=function(...T){if(this.threadId==y){let F=l.isStatic?void 0:new e.Parameter("this",-1,l.class.type),E=F?[F].concat(l.parameters):l.parameters;h.buffer.push(`\x1B[2m0x${f}\x1B[0m ${"\u2502 ".repeat(h.depth++)}\u250C\u2500\x1B[35m${l.class.type.name}::\x1B[1m${l.name}\x1B[0m\x1B[0m(${E.map($=>`\x1B[32m${$.name}\x1B[0m = \x1B[31m${e.fromFridaValue(T[$.position+S],$.type)}\x1B[0m`).join(", ")})`)}let N=l.nativeFunction(...T);return this.threadId==y&&(h.buffer.push(`\x1B[2m0x${f}\x1B[0m ${"\u2502 ".repeat(--h.depth)}\u2514\u2500\x1B[33m${l.class.type.name}::\x1B[1m${l.name}\x1B[0m\x1B[0m${N==null?"":` = \x1B[36m${e.fromFridaValue(N,l.returnType)}`}\x1B[0m`),h.flush()),N};l.revert();let p=new NativeCallback(g,l.returnType.fridaAlias,l.fridaSignature);Interceptor.replace(l.virtualAddress,p)};return new e.Tracer(s?a():i())}e.trace=o;function n(s){let i=e.domain.assemblies.flatMap(h=>h.image.classes.flatMap(y=>y.methods.filter(f=>!f.virtualAddress.isNull()))).sort((h,y)=>h.virtualAddress.compare(y.virtualAddress)),a=h=>{let y=0,f=i.length-1;for(;y<=f;){let S=Math.floor((y+f)/2),g=i[S].virtualAddress.compare(h);if(g==0)return i[S];g>0?f=S-1:y=S+1}return i[f]},l=()=>(h,y,f)=>{Interceptor.attach(h.virtualAddress,function(){if(this.threadId==f){let S=globalThis.Thread.backtrace(this.context,s);S.unshift(h.virtualAddress);for(let g of S)if(g.compare(e.module.base)>0&&g.compare(e.module.base.add(e.module.size))<0){let p=a(g);if(p){let T=g.sub(p.virtualAddress);T.compare(4095)<0&&y.buffer.push(`\x1B[2m0x${p.relativeVirtualAddress.toString(16).padStart(8,"0")}\x1B[0m\x1B[2m+0x${T.toString(16).padStart(3,"0")}\x1B[0m ${p.class.type.name}::\x1B[1m${p.name}\x1B[0m`)}}y.flush()}})};return new e.Tracer(l())}e.backtrace=n;function r(s){let i=3735928559,a=1103547991;for(let l=0,h;l<s.length;l++)h=s.charCodeAt(l),i=Math.imul(i^h,2654435761),a=Math.imul(a^h,1597334677);return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507),a^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&a)+(i>>>0)}})(d||(d={}));var d;(function(e){class t extends _{static get headerSize(){return e.corlib.class("System.Array").instanceSize}get elements(){let s=e.string("v").object.method("ToCharArray",0).invoke().handle.offsetOf(i=>i.readS16()==118)??m("couldn't find the elements offset in the native array struct");return b(e.Array.prototype,"elements",function(){return new e.Pointer(this.handle.add(s),this.elementType)},c),this.elements}get elementSize(){return this.elementType.class.arrayElementSize}get elementType(){return this.object.class.type.class.baseType}get length(){return e.api.arrayGetLength(this)}get object(){return new e.Object(this)}get(r){return(r<0||r>=this.length)&&m(`cannot get element at index ${r} as the array length is ${this.length}`),this.elements.get(r)}set(r,s){(r<0||r>=this.length)&&m(`cannot set element at index ${r} as the array length is ${this.length}`),this.elements.set(r,s)}toString(){return this.isNull()?"null":`[${this.elements.read(this.length,0)}]`}*[Symbol.iterator](){for(let r=0;r<this.length;r++)yield this.elements.get(r)}}u([c],t.prototype,"elementSize",null),u([c],t.prototype,"elementType",null),u([c],t.prototype,"length",null),u([c],t.prototype,"object",null),u([c],t,"headerSize",null),e.Array=t;function o(n,r){let s=typeof r=="number"?r:r.length,i=new e.Array(e.api.arrayNew(n,s));return globalThis.Array.isArray(r)&&i.elements.write(r),i}e.array=o})(d||(d={}));var d;(function(e){let t=class extends _{get image(){let n=function(){return new e.Image(e.api.assemblyGetImage(this))};try{e.api.assemblyGetImage}catch{n=function(){return new e.Image(this.object.method("GetType",1).invoke(e.string("<Module>")).method("get_Module").invoke().field("_impl").value)}}return b(e.Assembly.prototype,"image",n,c),this.image}get name(){return this.image.name.replace(".dll","")}get object(){for(let n of e.domain.object.method("GetAssemblies",1).invoke(!1))if(n.field("_mono_assembly").value.equals(this))return n;m("couldn't find the object of the native assembly struct")}};u([c],t.prototype,"name",null),u([c],t.prototype,"object",null),t=u([x],t),e.Assembly=t})(d||(d={}));var d;(function(e){let t=class extends _{get actualInstanceSize(){let n=e.corlib.class("System.String"),r=n.handle.offsetOf(s=>s.readInt()==n.instanceSize-2)??m("couldn't find the actual instance size offset in the native class struct");return b(e.Class.prototype,"actualInstanceSize",function(){return this.handle.add(r).readS32()},c),this.actualInstanceSize}get arrayClass(){return new e.Class(e.api.classGetArrayClass(this,1))}get arrayElementSize(){return e.api.classGetArrayElementSize(this)}get assemblyName(){return e.api.classGetAssemblyName(this).readUtf8String().replace(".dll","")}get declaringClass(){return new e.Class(e.api.classGetDeclaringType(this)).asNullable()}get baseType(){return new e.Type(e.api.classGetBaseType(this)).asNullable()}get elementClass(){return new e.Class(e.api.classGetElementClass(this)).asNullable()}get fields(){return w(n=>e.api.classGetFields(this,n)).map(n=>new e.Field(n))}get flags(){return e.api.classGetFlags(this)}get fullName(){return this.namespace?`${this.namespace}.${this.name}`:this.name}get generics(){if(!this.isGeneric&&!this.isInflated)return[];let n=this.type.object.method("GetGenericArguments").invoke();return globalThis.Array.from(n).map(r=>new e.Class(e.api.classFromObject(r)))}get hasReferences(){return!!e.api.classHasReferences(this)}get hasStaticConstructor(){let n=this.tryMethod(".cctor");return n!=null&&!n.virtualAddress.isNull()}get image(){return new e.Image(e.api.classGetImage(this))}get instanceSize(){return e.api.classGetInstanceSize(this)}get isAbstract(){return!!e.api.classIsAbstract(this)}get isBlittable(){return!!e.api.classIsBlittable(this)}get isEnum(){return!!e.api.classIsEnum(this)}get isGeneric(){return!!e.api.classIsGeneric(this)}get isInflated(){return!!e.api.classIsInflated(this)}get isInterface(){return!!e.api.classIsInterface(this)}get isStruct(){return this.isValueType&&!this.isEnum}get isValueType(){return!!e.api.classIsValueType(this)}get interfaces(){return w(n=>e.api.classGetInterfaces(this,n)).map(n=>new e.Class(n))}get methods(){return w(n=>e.api.classGetMethods(this,n)).map(n=>new e.Method(n))}get name(){return e.api.classGetName(this).readUtf8String()}get namespace(){return e.api.classGetNamespace(this).readUtf8String()}get nestedClasses(){return w(n=>e.api.classGetNestedClasses(this,n)).map(n=>new e.Class(n))}get parent(){return new e.Class(e.api.classGetParent(this)).asNullable()}get rank(){let n=0,r=this.name;for(let s=this.name.length-1;s>0;s--){let i=r[s];if(i=="]")n++;else{if(i=="["||n==0)break;if(i==",")n++;else break}}return n}get staticFieldsData(){return e.api.classGetStaticFieldData(this)}get valueTypeSize(){return e.api.classGetValueTypeSize(this,NULL)}get type(){return new e.Type(e.api.classGetType(this))}alloc(){return new e.Object(e.api.objectNew(this))}field(n){return this.tryField(n)??m(`couldn't find field ${n} in class ${this.type.name}`)}inflate(...n){this.isGeneric||m(`cannot inflate class ${this.type.name} as it has no generic parameters`),this.generics.length!=n.length&&m(`cannot inflate class ${this.type.name} as it needs ${this.generics.length} generic parameter(s), not ${n.length}`);let r=n.map(a=>a.type.object),s=e.array(e.corlib.class("System.Type"),r),i=this.type.object.method("MakeGenericType",1).invoke(s);return new e.Class(e.api.classFromObject(i))}initialize(){return e.api.classInitialize(this),this}isAssignableFrom(n){return!!e.api.classIsAssignableFrom(this,n)}isSubclassOf(n,r){return!!e.api.classIsSubclassOf(this,n,+r)}method(n,r=-1){return this.tryMethod(n,r)??m(`couldn't find method ${n} in class ${this.type.name}`)}nested(n){return this.tryNested(n)??m(`couldn't find nested class ${n} in class ${this.type.name}`)}new(){let n=this.alloc(),r=Memory.alloc(Process.pointerSize);e.api.objectInitialize(n,r);let s=r.readPointer();return s.isNull()||m(new e.Object(s).toString()),n}tryField(n){return new e.Field(e.api.classGetFieldFromName(this,Memory.allocUtf8String(n))).asNullable()}tryMethod(n,r=-1){return new e.Method(e.api.classGetMethodFromName(this,Memory.allocUtf8String(n),r)).asNullable()}tryNested(n){return this.nestedClasses.find(r=>r.name==n)}toString(){let n=[this.parent].concat(this.interfaces);return`// ${this.assemblyName}
${this.isEnum?"enum":this.isStruct?"struct":this.isInterface?"interface":"class"} ${this.type.name}${n?` : ${n.map(r=>r?.type.name).join(", ")}`:""}
{
    ${this.fields.join(`
    `)}
    ${this.methods.join(`
    `)}
}`}static enumerate(n){let r=new NativeCallback(s=>n(new e.Class(s)),"void",["pointer","pointer"]);return e.api.classForEach(r,NULL)}};u([c],t.prototype,"arrayClass",null),u([c],t.prototype,"arrayElementSize",null),u([c],t.prototype,"assemblyName",null),u([c],t.prototype,"declaringClass",null),u([c],t.prototype,"baseType",null),u([c],t.prototype,"elementClass",null),u([c],t.prototype,"fields",null),u([c],t.prototype,"flags",null),u([c],t.prototype,"fullName",null),u([c],t.prototype,"generics",null),u([c],t.prototype,"hasReferences",null),u([c],t.prototype,"hasStaticConstructor",null),u([c],t.prototype,"image",null),u([c],t.prototype,"instanceSize",null),u([c],t.prototype,"isAbstract",null),u([c],t.prototype,"isBlittable",null),u([c],t.prototype,"isEnum",null),u([c],t.prototype,"isGeneric",null),u([c],t.prototype,"isInflated",null),u([c],t.prototype,"isInterface",null),u([c],t.prototype,"isValueType",null),u([c],t.prototype,"interfaces",null),u([c],t.prototype,"methods",null),u([c],t.prototype,"name",null),u([c],t.prototype,"namespace",null),u([c],t.prototype,"nestedClasses",null),u([c],t.prototype,"parent",null),u([c],t.prototype,"rank",null),u([c],t.prototype,"staticFieldsData",null),u([c],t.prototype,"valueTypeSize",null),u([c],t.prototype,"type",null),t=u([x],t),e.Class=t})(d||(d={}));var d;(function(e){function t(o,n){let r=e.corlib.class("System.Delegate"),s=e.corlib.class("System.MulticastDelegate");r.isAssignableFrom(o)||m(`cannot create a delegate for ${o.type.name} as it's a non-delegate class`),(o.equals(r)||o.equals(s))&&m(`cannot create a delegate for neither ${r.type.name} nor ${s.type.name}, use a subclass instead`);let i=o.alloc(),a=i.handle.toString(),l=i.tryMethod("Invoke")??m(`cannot create a delegate for ${o.type.name}, there is no Invoke method`);i.method(".ctor").invoke(i,l.handle);let h=l.wrap(n);return i.field("method_ptr").value=h,i.field("invoke_impl").value=h,e._callbacksToKeepAlive[a]=h,i}e.delegate=t,e._callbacksToKeepAlive={}})(d||(d={}));var d;(function(e){let t=class extends _{get assemblies(){let n=M(r=>e.api.domainGetAssemblies(this,r));if(n.length==0){let r=this.object.method("GetAssemblies").overload().invoke();n=globalThis.Array.from(r).map(s=>s.field("_mono_assembly").value)}return n.map(r=>new e.Assembly(r))}get object(){return e.corlib.class("System.AppDomain").method("get_CurrentDomain").invoke()}assembly(n){return this.tryAssembly(n)??m(`couldn't find assembly ${n}`)}attach(){return new e.Thread(e.api.threadAttach(this))}tryAssembly(n){return new e.Assembly(e.api.domainGetAssemblyFromName(this,Memory.allocUtf8String(n))).asNullable()}};u([c],t.prototype,"assemblies",null),u([c],t.prototype,"object",null),t=u([x],t),e.Domain=t,b(e,"domain",()=>new e.Domain(e.api.domainGet()),c)})(d||(d={}));var d;(function(e){class t extends _{get class(){return new e.Class(e.api.fieldGetClass(this))}get flags(){return e.api.fieldGetFlags(this)}get isLiteral(){return(this.flags&64)!=0}get isStatic(){return(this.flags&16)!=0}get isThreadStatic(){let n=e.corlib.class("System.AppDomain").field("type_resolve_in_progress").offset;return b(e.Field.prototype,"isThreadStatic",function(){return this.offset==n},c),this.isThreadStatic}get modifier(){switch(this.flags&7){case 1:return"private";case 2:return"private protected";case 3:return"internal";case 4:return"protected";case 5:return"protected internal";case 6:return"public"}}get name(){return e.api.fieldGetName(this).readUtf8String()}get offset(){return e.api.fieldGetOffset(this)}get type(){return new e.Type(e.api.fieldGetType(this))}get value(){this.isStatic||m(`cannot access instance field ${this.class.type.name}::${this.name} from a class, use an object instead`);let n=Memory.alloc(Process.pointerSize);return e.api.fieldGetStaticValue(this.handle,n),e.read(n,this.type)}set value(n){this.isStatic||m(`cannot access instance field ${this.class.type.name}::${this.name} from a class, use an object instead`),(this.isThreadStatic||this.isLiteral)&&m(`cannot write the value of field ${this.name} as it's thread static or literal`);let r=n instanceof e.Object&&this.type.class.isValueType?n.unbox():n instanceof _?n.handle:n instanceof NativePointer?n:e.write(Memory.alloc(this.type.class.valueTypeSize),n,this.type);e.api.fieldSetStaticValue(this.handle,r)}toString(){return`${this.isThreadStatic?"[ThreadStatic] ":""}${this.isStatic?"static ":""}${this.type.name} ${this.name}${this.isLiteral?` = ${this.type.class.isEnum?e.read(this.value.handle,this.type.class.baseType):this.value}`:""};${this.isThreadStatic||this.isLiteral?"":` // 0x${this.offset.toString(16)}`}`}withHolder(n){this.isStatic&&m(`cannot access static field ${this.class.type.name}::${this.name} from an object, use a class instead`);let r=n.handle.add(this.offset-(n instanceof e.ValueType?e.Object.headerSize:0));return new Proxy(this,{get(s,i){return i=="value"?e.read(r,s.type):Reflect.get(s,i)},set(s,i,a){return i=="value"?(e.write(r,a,s.type),!0):Reflect.set(s,i,a)}})}}u([c],t.prototype,"class",null),u([c],t.prototype,"flags",null),u([c],t.prototype,"isLiteral",null),u([c],t.prototype,"isStatic",null),u([c],t.prototype,"isThreadStatic",null),u([c],t.prototype,"modifier",null),u([c],t.prototype,"name",null),u([c],t.prototype,"offset",null),u([c],t.prototype,"type",null),e.Field=t})(d||(d={}));var d;(function(e){class t{handle;constructor(n){this.handle=n}get target(){return new e.Object(e.api.gcHandleGetTarget(this.handle)).asNullable()}free(){return e.api.gcHandleFree(this.handle)}}e.GCHandle=t})(d||(d={}));var d;(function(e){let t=class extends _{get assembly(){return new e.Assembly(e.api.imageGetAssembly(this))}get classCount(){return e.unityVersionIsBelow201830?this.classes.length:e.api.imageGetClassCount(this)}get classes(){if(e.unityVersionIsBelow201830){let n=this.assembly.object.method("GetTypes").invoke(!1),r=globalThis.Array.from(n,s=>new e.Class(e.api.classFromObject(s)));return r.unshift(this.class("<Module>")),r}else return globalThis.Array.from(globalThis.Array(this.classCount),(n,r)=>new e.Class(e.api.imageGetClass(this,r)))}get name(){return e.api.imageGetName(this).readUtf8String()}class(n){return this.tryClass(n)??m(`couldn't find class ${n} in assembly ${this.name}`)}tryClass(n){let r=n.lastIndexOf("."),s=Memory.allocUtf8String(r==-1?"":n.slice(0,r)),i=Memory.allocUtf8String(n.slice(r+1));return new e.Class(e.api.classFromName(this,s,i)).asNullable()}};u([c],t.prototype,"assembly",null),u([c],t.prototype,"classCount",null),u([c],t.prototype,"classes",null),u([c],t.prototype,"name",null),t=u([x],t),e.Image=t,b(e,"corlib",()=>new e.Image(e.api.getCorlib()),c)})(d||(d={}));var d;(function(e){class t extends _{static capture(){return new e.MemorySnapshot}constructor(r=e.api.memorySnapshotCapture()){super(r)}get classes(){return w(r=>e.api.memorySnapshotGetClasses(this,r)).map(r=>new e.Class(r))}get objects(){return M(r=>e.api.memorySnapshotGetObjects(this,r)).filter(r=>!r.isNull()).map(r=>new e.Object(r))}free(){e.api.memorySnapshotFree(this)}}u([c],t.prototype,"classes",null),u([c],t.prototype,"objects",null),e.MemorySnapshot=t;function o(n){let r=e.MemorySnapshot.capture(),s=n(r);return r.free(),s}e.memorySnapshot=o})(d||(d={}));var d;(function(e){class t extends _{get class(){return new e.Class(e.api.methodGetClass(this))}get flags(){return e.api.methodGetFlags(this,NULL)}get implementationFlags(){let r=Memory.alloc(Process.pointerSize);return e.api.methodGetFlags(this,r),r.readU32()}get fridaSignature(){let r=[];for(let s of this.parameters)r.push(s.type.fridaAlias);return(!this.isStatic||e.unityVersionIsBelow201830)&&r.unshift("pointer"),this.isInflated&&r.push("pointer"),r}get generics(){if(!this.isGeneric&&!this.isInflated)return[];let r=this.object.method("GetGenericArguments").invoke();return globalThis.Array.from(r).map(s=>new e.Class(e.api.classFromObject(s)))}get isExternal(){return(this.implementationFlags&4096)!=0}get isGeneric(){return!!e.api.methodIsGeneric(this)}get isInflated(){return!!e.api.methodIsInflated(this)}get isStatic(){return!e.api.methodIsInstance(this)}get isSynchronized(){return(this.implementationFlags&32)!=0}get modifier(){switch(this.flags&7){case 1:return"private";case 2:return"private protected";case 3:return"internal";case 4:return"protected";case 5:return"protected internal";case 6:return"public"}}get name(){return e.api.methodGetName(this).readUtf8String()}get nativeFunction(){return new NativeFunction(this.virtualAddress,this.returnType.fridaAlias,this.fridaSignature)}get object(){return new e.Object(e.api.methodGetObject(this,NULL))}get parameterCount(){return e.api.methodGetParameterCount(this)}get parameters(){return globalThis.Array.from(globalThis.Array(this.parameterCount),(r,s)=>{let i=e.api.methodGetParameterName(this,s).readUtf8String(),a=e.api.methodGetParameterType(this,s);return new e.Parameter(i,s,new e.Type(a))})}get relativeVirtualAddress(){return this.virtualAddress.sub(e.module.base)}get returnType(){return new e.Type(e.api.methodGetReturnType(this))}get virtualAddress(){let r=e.corlib.class("System.Reflection.Module").initialize().field("FilterTypeName").value,s=r.field("method_ptr").value,a=r.field("method").value.offsetOf(l=>l.readPointer().equals(s))??m("couldn't find the virtual address offset in the native method struct");return b(e.Method.prototype,"virtualAddress",function(){return this.handle.add(a).readPointer()},c),e.corlib.class("System.Reflection.Module").method(".cctor").invoke(),this.virtualAddress}set implementation(r){try{Interceptor.replace(this.virtualAddress,this.wrap(r))}catch(s){switch(s.message){case"access violation accessing 0x0":m(`couldn't set implementation for method ${this.name} as it has a NULL virtual address`);case/unable to intercept function at \w+; please file a bug/.exec(s.message)?.input:A(`couldn't set implementation for method ${this.name} as it may be a thunk`);break;case"already replaced this function":A(`couldn't set implementation for method ${this.name} as it has already been replaced by a thunk`);break;default:throw s}}}inflate(...r){this.isGeneric||m(`cannot inflate method ${this.name} as it has no generic parameters`),this.generics.length!=r.length&&m(`cannot inflate method ${this.name} as it needs ${this.generics.length} generic parameter(s), not ${r.length}`);let s=r.map(l=>l.type.object),i=e.array(e.corlib.class("System.Type"),s),a=this.object.method("MakeGenericMethod",1).invoke(i);return new e.Method(a.field("mhandle").value)}invoke(...r){return this.isStatic||m(`cannot invoke non-static method ${this.name} as it must be invoked throught a Il2Cpp.Object, not a Il2Cpp.Class`),this.invokeRaw(NULL,...r)}invokeRaw(r,...s){let i=s.map(e.toFridaValue);(!this.isStatic||e.unityVersionIsBelow201830)&&i.unshift(r),this.isInflated&&i.push(this.handle);try{let a=this.nativeFunction(...i);return e.fromFridaValue(a,this.returnType)}catch(a){switch(a==null&&m("an unexpected native invocation exception occurred, this is due to parameter types mismatch"),a.message){case"bad argument count":m(`couldn't invoke method ${this.name} as it needs ${this.parameterCount} parameter(s), not ${s.length}`);case"expected a pointer":case"expected number":case"expected array with fields":m(`couldn't invoke method ${this.name} using incorrect parameter types`)}throw a}}overload(...r){let s=this.tryOverload(...r);if(s!=null)return s;m(`couldn't find overloaded method ${this.name}(${r})`)}parameter(r){return this.tryParameter(r)??m(`couldn't find parameter ${r} in method ${this.name}`)}revert(){Interceptor.revert(this.virtualAddress),Interceptor.flush()}tryOverload(...r){return this.class.methods.find(s=>s.name==this.name&&s.parameterCount==r.length&&s.parameters.every((i,a)=>i.type.name==r[a]))}tryParameter(r){return this.parameters.find(s=>s.name==r)}toString(){return`${this.isStatic?"static ":""}${this.returnType.name} ${this.name}(${this.parameters.join(", ")});${this.virtualAddress.isNull()?"":` // 0x${this.relativeVirtualAddress.toString(16).padStart(8,"0")}`}`}withHolder(r){return this.isStatic&&m(`cannot access static method ${this.class.type.name}::${this.name} from an object, use a class instead`),new Proxy(this,{get(s,i){switch(i){case"invoke":let a=r instanceof e.ValueType?s.class.isValueType?r.handle.add(o()-e.Object.headerSize):m(`cannot invoke method ${s.class.type.name}::${s.name} against a value type, you must box it first`):s.class.isValueType?r.handle.add(o()):r.handle;return s.invokeRaw.bind(s,a);case"inflate":case"overload":case"tryOverload":return function(...l){return s[i](...l)?.withHolder(r)}}return Reflect.get(s,i)}})}wrap(r){let s=+!this.isStatic|+e.unityVersionIsBelow201830;return new NativeCallback((...i)=>{let a=this.isStatic?this.class:this.class.isValueType?new e.ValueType(i[0].add(e.Object.headerSize-o()),this.class.type):new e.Object(i[0]),l=this.parameters.map((y,f)=>e.fromFridaValue(i[f+s],y.type)),h=r.call(a,...l);return e.toFridaValue(h)},this.returnType.fridaAlias,this.fridaSignature)}}u([c],t.prototype,"class",null),u([c],t.prototype,"flags",null),u([c],t.prototype,"implementationFlags",null),u([c],t.prototype,"fridaSignature",null),u([c],t.prototype,"generics",null),u([c],t.prototype,"isExternal",null),u([c],t.prototype,"isGeneric",null),u([c],t.prototype,"isInflated",null),u([c],t.prototype,"isStatic",null),u([c],t.prototype,"isSynchronized",null),u([c],t.prototype,"modifier",null),u([c],t.prototype,"name",null),u([c],t.prototype,"nativeFunction",null),u([c],t.prototype,"object",null),u([c],t.prototype,"parameterCount",null),u([c],t.prototype,"parameters",null),u([c],t.prototype,"relativeVirtualAddress",null),u([c],t.prototype,"returnType",null),e.Method=t;let o=()=>{let n=e.corlib.class("System.RuntimeTypeHandle").initialize().alloc();n.method(".ctor").invokeRaw(n,ptr(3735928559));let r=n.field("value").value.equals(ptr(3735928559))?0:e.Object.headerSize;return(o=()=>r)()}})(d||(d={}));var d;(function(e){class t extends _{static get headerSize(){return e.corlib.class("System.Object").instanceSize}get class(){return new e.Class(e.api.objectGetClass(this))}get monitor(){return new e.Object.Monitor(this)}get size(){return e.api.objectGetSize(this)}field(n){return this.class.field(n).withHolder(this)}method(n,r=-1){return this.class.method(n,r).withHolder(this)}ref(n){return new e.GCHandle(e.api.gcHandleNew(this,+n))}virtualMethod(n){return new e.Method(e.api.objectGetVirtualMethod(this,n)).withHolder(this)}tryField(n){return this.class.tryField(n)?.withHolder(this)}tryMethod(n,r=-1){return this.class.tryMethod(n,r)?.withHolder(this)}toString(){return this.isNull()?"null":this.method("ToString",0).invoke().content??"null"}unbox(){return this.class.isValueType?new e.ValueType(e.api.objectUnbox(this),this.class.type):m(`couldn't unbox instances of ${this.class.type.name} as they are not value types`)}weakRef(n){return new e.GCHandle(e.api.gcHandleNewWeakRef(this,+n))}}u([c],t.prototype,"class",null),u([c],t.prototype,"size",null),u([c],t,"headerSize",null),e.Object=t,function(o){class n{handle;constructor(s){this.handle=s}enter(){return e.api.monitorEnter(this.handle)}exit(){return e.api.monitorExit(this.handle)}pulse(){return e.api.monitorPulse(this.handle)}pulseAll(){return e.api.monitorPulseAll(this.handle)}tryEnter(s){return!!e.api.monitorTryEnter(this.handle,s)}tryWait(s){return!!e.api.monitorTryWait(this.handle,s)}wait(){return e.api.monitorWait(this.handle)}}o.Monitor=n}(t=e.Object||(e.Object={}))})(d||(d={}));var d;(function(e){class t{name;position;type;constructor(n,r,s){this.name=n,this.position=r,this.type=s}toString(){return`${this.type.name} ${this.name}`}}e.Parameter=t})(d||(d={}));var d;(function(e){class t extends _{type;constructor(n,r){super(n),this.type=r}get(n){return e.read(this.handle.add(n*this.type.class.arrayElementSize),this.type)}read(n,r=0){let s=new globalThis.Array(n);for(let i=0;i<n;i++)s[i]=this.get(i+r);return s}set(n,r){e.write(this.handle.add(n*this.type.class.arrayElementSize),r,this.type)}toString(){return this.handle.toString()}write(n,r=0){for(let s=0;s<n.length;s++)this.set(s+r,n[s])}}e.Pointer=t})(d||(d={}));var d;(function(e){class t extends _{type;constructor(r,s){super(r),this.type=s}get value(){return e.read(this.handle,this.type)}set value(r){e.write(this.handle,r,this.type)}toString(){return this.isNull()?"null":`->${this.value}`}}e.Reference=t;function o(n,r){let s=Memory.alloc(Process.pointerSize);switch(typeof n){case"boolean":return new e.Reference(s.writeS8(+n),e.corlib.class("System.Boolean").type);case"number":switch(r?.typeEnum){case e.Type.enum.unsignedByte:return new e.Reference(s.writeU8(n),r);case e.Type.enum.byte:return new e.Reference(s.writeS8(n),r);case e.Type.enum.char:case e.Type.enum.unsignedShort:return new e.Reference(s.writeU16(n),r);case e.Type.enum.short:return new e.Reference(s.writeS16(n),r);case e.Type.enum.unsignedInt:return new e.Reference(s.writeU32(n),r);case e.Type.enum.int:return new e.Reference(s.writeS32(n),r);case e.Type.enum.unsignedLong:return new e.Reference(s.writeU64(n),r);case e.Type.enum.long:return new e.Reference(s.writeS64(n),r);case e.Type.enum.float:return new e.Reference(s.writeFloat(n),r);case e.Type.enum.double:return new e.Reference(s.writeDouble(n),r)}case"object":if(n instanceof e.ValueType||n instanceof e.Pointer)return new e.Reference(s.writePointer(n),n.type);if(n instanceof e.Object)return new e.Reference(s.writePointer(n),n.class.type);if(n instanceof e.String||n instanceof e.Array)return new e.Reference(s.writePointer(n),n.object.class.type);if(n instanceof NativePointer)switch(r?.typeEnum){case e.Type.enum.unsignedNativePointer:case e.Type.enum.nativePointer:return new e.Reference(s.writePointer(n),r)}else{if(n instanceof Int64)return new e.Reference(s.writeS64(n),e.corlib.class("System.Int64").type);if(n instanceof UInt64)return new e.Reference(s.writeU64(n),e.corlib.class("System.UInt64").type)}default:m(`couldn't create a reference to ${n} using an unhandled type ${r?.name}`)}}e.reference=o})(d||(d={}));var d;(function(e){class t extends _{get content(){return e.api.stringGetChars(this).readUtf16String(this.length)}set content(r){let s=e.string("vfsfitvnm").handle.offsetOf(i=>i.readInt()==9)??m("couldn't find the length offset in the native string struct");globalThis.Object.defineProperty(e.String.prototype,"content",{set(i){e.api.stringGetChars(this).writeUtf16String(i??""),this.handle.add(s).writeS32(i?.length??0)}}),this.content=r}get length(){return e.api.stringGetLength(this)}get object(){return new e.Object(this)}toString(){return this.isNull()?"null":`"${this.content}"`}}e.String=t;function o(n){return new e.String(e.api.stringNew(Memory.allocUtf8String(n??"")))}e.string=o})(d||(d={}));var d;(function(e){class t extends _{get id(){let n=function(){return this.internal.field("thread_id").value.toNumber()};if(Process.platform!="windows"){let r=Process.getCurrentThreadId(),i=ptr(n.apply(e.currentThread)).offsetOf(l=>l.readS32()==r,1024)??m("couldn't find the offset for determining the kernel id of a posix thread"),a=n;n=function(){return ptr(a.apply(this)).add(i).readS32()}}return b(e.Thread.prototype,"id",n,c),this.id}get internal(){return this.object.tryField("internal_thread")?.value??this.object}get isFinalizer(){return!e.api.threadIsVm(this)}get managedId(){return this.object.method("get_ManagedThreadId").invoke()}get object(){return new e.Object(this)}get staticData(){return this.internal.field("static_data").value}get synchronizationContext(){let r=(this.object.tryMethod("GetMutableExecutionContext")??this.object.method("get_ExecutionContext")).invoke(),s=r.tryField("_syncContext")?.value??r.tryMethod("get_SynchronizationContext")?.invoke()??this.tryLocalValue(e.corlib.class("System.Threading.SynchronizationContext"));return(s==null||s.isNull())&&(this.handle.equals(e.mainThread.handle)?m("couldn't find the synchronization context of the main thread, perhaps this is early instrumentation?"):m(`couldn't find the synchronization context of thread #${this.managedId}, only the main thread is expected to have one`)),s}detach(){return e.api.threadDetach(this)}schedule(n){let r=this.synchronizationContext.method("Post");return new Promise(s=>{let i=e.delegate(e.corlib.class("System.Threading.SendOrPostCallback"),()=>{let a=n();setImmediate(()=>s(a))});Script.bindWeak(globalThis,()=>{i.field("method_ptr").value=i.field("invoke_impl").value=e.api.domainGet}),r.invoke(i,NULL)})}tryLocalValue(n){for(let r=0;r<16;r++){let s=this.staticData.add(r*Process.pointerSize).readPointer();if(!s.isNull()){let i=new e.Object(s.readPointer()).asNullable();if(i?.class?.isSubclassOf(n,!1))return i}}}}u([c],t.prototype,"internal",null),u([c],t.prototype,"isFinalizer",null),u([c],t.prototype,"managedId",null),u([c],t.prototype,"object",null),u([c],t.prototype,"staticData",null),u([c],t.prototype,"synchronizationContext",null),e.Thread=t,b(e,"attachedThreads",()=>M(e.api.threadGetAttachedThreads).map(o=>new e.Thread(o))),b(e,"currentThread",()=>new e.Thread(e.api.threadGetCurrent()).asNullable()),b(e,"mainThread",()=>e.attachedThreads[0])})(d||(d={}));var d;(function(e){let t=class extends _{static get enum(){let n=(r,s=i=>i)=>s(e.corlib.class(r)).type.typeEnum;return{void:n("System.Void"),boolean:n("System.Boolean"),char:n("System.Char"),byte:n("System.SByte"),unsignedByte:n("System.Byte"),short:n("System.Int16"),unsignedShort:n("System.UInt16"),int:n("System.Int32"),unsignedInt:n("System.UInt32"),long:n("System.Int64"),unsignedLong:n("System.UInt64"),nativePointer:n("System.IntPtr"),unsignedNativePointer:n("System.UIntPtr"),float:n("System.Single"),double:n("System.Double"),pointer:n("System.IntPtr",r=>r.field("m_value")),valueType:n("System.Decimal"),object:n("System.Object"),string:n("System.String"),class:n("System.Array"),array:n("System.Void",r=>r.arrayClass),multidimensionalArray:n("System.Void",r=>new e.Class(e.api.classGetArrayClass(r,2))),genericInstance:n("System.Int32",r=>r.interfaces.find(s=>s.name.endsWith("`1")))}}get class(){return new e.Class(e.api.typeGetClass(this))}get fridaAlias(){function n(r){let s=r.class.fields.filter(i=>!i.isStatic);return s.length==0?["char"]:s.map(i=>i.type.fridaAlias)}if(this.isByReference)return"pointer";switch(this.typeEnum){case e.Type.enum.void:return"void";case e.Type.enum.boolean:return"bool";case e.Type.enum.char:return"uchar";case e.Type.enum.byte:return"int8";case e.Type.enum.unsignedByte:return"uint8";case e.Type.enum.short:return"int16";case e.Type.enum.unsignedShort:return"uint16";case e.Type.enum.int:return"int32";case e.Type.enum.unsignedInt:return"uint32";case e.Type.enum.long:return"int64";case e.Type.enum.unsignedLong:return"uint64";case e.Type.enum.float:return"float";case e.Type.enum.double:return"double";case e.Type.enum.nativePointer:case e.Type.enum.unsignedNativePointer:case e.Type.enum.pointer:case e.Type.enum.string:case e.Type.enum.array:case e.Type.enum.multidimensionalArray:return"pointer";case e.Type.enum.valueType:return this.class.isEnum?this.class.baseType.fridaAlias:n(this);case e.Type.enum.class:case e.Type.enum.object:case e.Type.enum.genericInstance:return this.class.isStruct?n(this):this.class.isEnum?this.class.baseType.fridaAlias:"pointer";default:return"pointer"}}get isByReference(){return this.name.endsWith("&")}get isPrimitive(){switch(this.typeEnum){case e.Type.enum.boolean:case e.Type.enum.char:case e.Type.enum.byte:case e.Type.enum.unsignedByte:case e.Type.enum.short:case e.Type.enum.unsignedShort:case e.Type.enum.int:case e.Type.enum.unsignedInt:case e.Type.enum.long:case e.Type.enum.unsignedLong:case e.Type.enum.float:case e.Type.enum.double:case e.Type.enum.nativePointer:case e.Type.enum.unsignedNativePointer:return!0;default:return!1}}get name(){let n=e.api.typeGetName(this);try{return n.readUtf8String()}finally{e.free(n)}}get object(){return new e.Object(e.api.typeGetObject(this))}get typeEnum(){return e.api.typeGetTypeEnum(this)}toString(){return this.name}};u([c],t.prototype,"class",null),u([c],t.prototype,"fridaAlias",null),u([c],t.prototype,"isByReference",null),u([c],t.prototype,"isPrimitive",null),u([c],t.prototype,"name",null),u([c],t.prototype,"object",null),u([c],t.prototype,"typeEnum",null),u([c],t,"enum",null),t=u([x],t),e.Type=t})(d||(d={}));var d;(function(e){class t extends _{type;constructor(n,r){super(n),this.type=r}box(){return new e.Object(e.api.valueTypeBox(this.type.class,this))}field(n){return this.type.class.field(n).withHolder(this)}method(n,r=-1){return this.type.class.method(n,r).withHolder(this)}tryField(n){return this.type.class.tryField(n)?.withHolder(this)}tryMethod(n,r=-1){return this.type.class.tryMethod(n,r)?.withHolder(this)}toString(){let n=this.method("ToString",0);return this.isNull()?"null":n.class.isValueType?n.invoke().content??"null":this.box().toString()??"null"}}e.ValueType=t})(d||(d={}));globalThis.Il2Cpp=d;var j=!1,L;setTimeout(()=>{Il2Cpp.perform(()=>{k("Loaded 3DOF script.");let e=Il2Cpp.domain.assembly("Assembly-CSharp").image;e.class("Launcher.Home.AppMirrorCardWindow").method("ProcessInput").implementation=function(t,o){return L=this,t.toString()==="Escape"&&o.toString()==="LongPress"&&(j=!j,k(j?"3DOF mode enabled.":"0DOF mode enabled.")),this.method("ProcessInput").invoke(t,o)},e.class("Launcher.Home.EvaAppOpenCmd").method("OpenEvaApp").implementation=function(t){t.field("displayMode").value=j?0:2}})},2e3);function k(e){let t=Java.use("android.widget.Toast");try{Java.scheduleOnMainThread(function(){t.makeText(Java.use("android.app.ActivityThread").currentApplication().getApplicationContext(),Java.use("java.lang.String").$new(e),0).show()})}catch(o){let n=o;console.log("Failed to show toast")}}})();
